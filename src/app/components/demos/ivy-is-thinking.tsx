import { DemoShell, useReplay } from "./demo-utils";
import imgDoctor from "figma:asset/doctor-photo.png";
import {
  colors,
  font,
  HamburgerIcon,
  ShieldIcon,
  AttachmentIcon,
  MicrophoneIcon,
} from "./nav-page-shared";

/* ─── Static Top Navigation (hamburger only) ─────────────── */

function TopNav({ rightSlot }: { rightSlot?: React.ReactNode }) {
  return (
    <div className="absolute left-0 top-0 w-[375px] flex flex-col items-start z-10">
      <div
        className="h-[112px] overflow-hidden relative shrink-0 w-full"
        style={{ backgroundColor: colors.surfaceStrong }}
      >
        <div className="absolute left-1/2 -translate-x-1/2 top-[63px] h-[48px] w-[335px] flex items-center justify-between">
          <div
            className="w-[52px] h-[48px] rounded-[56px] flex items-center justify-center overflow-hidden p-[2px]"
            style={{
              backgroundColor: colors.badgeBg,
              border: `1px solid ${colors.borderSubtle}`,
            }}
          >
            <HamburgerIcon />
          </div>

          <div className="flex items-center gap-[8px]">
            {rightSlot}
            <div
              className="w-[52px] h-[48px] rounded-[56px] flex items-center justify-center overflow-hidden p-[2px]"
              style={{
                backgroundColor: colors.badgeBg,
                border: `1px solid ${colors.borderSubtle}`,
              }}
            >
              <span
                className="text-[15px] tracking-[-0.57px] leading-[18.2px] font-normal"
                style={{ color: colors.primary, fontFamily: font }}
              >
                M
              </span>
            </div>
          </div>
        </div>
      </div>

      <div
        className="h-[50px] shrink-0 w-full"
        style={{
          background: `linear-gradient(to top, rgba(255,255,255,0), ${colors.surfaceStrong})`,
        }}
      />
    </div>
  );
}

/* ─── Avatars (ivy + doctor) ──────────────────────────────── */

function AvatarPair() {
  return (
    <div className="flex items-start pr-[8px] relative">
      <div
        className="relative rounded-full size-[36px] flex items-center justify-center z-[2] overflow-hidden border border-white"
        style={{ backgroundColor: colors.avatarBg }}
      >
        <span
          className="text-[14.3px] leading-[19.7px] tracking-[-0.65px] italic"
          style={{ color: colors.accent, fontFamily: '"Ivar Soft", serif' }}
        >
          ivy
        </span>
      </div>
      <div
        className="relative rounded-full size-[36px] -ml-[8px] z-[1] overflow-hidden border border-white"
        style={{ backgroundColor: colors.avatarBg }}
      >
        <img
          src={imgDoctor}
          alt="Doctor"
          className="absolute inset-0 w-full h-full object-cover"
        />
      </div>
    </div>
  );
}

/* ─── Care Team Badge (compact, in nav) ──────────────────── */

function CareTeamBadgeCompact() {
  return (
    <div
      className="h-[48px] rounded-[56px] flex items-center gap-[8px] overflow-hidden px-[8px] py-[2px]"
      style={{
        backgroundColor: colors.badgeBg,
        border: `1px solid ${colors.borderSubtle}`,
      }}
    >
      <AvatarPair />
    </div>
  );
}

/* ─── Selected Chip (with checkmark) ─────────────────────── */

function CheckIcon() {
  return (
    <svg width="7" height="5" viewBox="0 0 7 5" fill="none">
      <path
        d="M1 2.5L2.8 4L6 1"
        stroke={colors.accent}
        strokeWidth="1.2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}

function SelectedChip() {
  return (
    <div className="absolute left-1/2 -translate-x-1/2 top-[146px] w-[335px] flex flex-col items-end justify-center">
      <div
        className="flex items-center gap-[12px] h-[52.03px] rounded-[16px] overflow-hidden px-[16.32px]"
        style={{ backgroundColor: colors.secondary }}
      >
        <CheckIcon />
        <span
          className="text-[16.32px] leading-[18.57px] tracking-[-0.57px] font-normal"
          style={{ color: colors.primaryDark, fontFamily: font }}
        >
          I'm noticing some side effects
        </span>
      </div>
    </div>
  );
}

/* ─── Ivy Thinking Indicator ──────────────────────────────── */

function IvyThinkingIndicator() {
  return (
    <div className="absolute left-1/2 -translate-x-1/2 top-[222px] w-[335px] flex items-start">
      <svg
        width="144"
        height="24"
        viewBox="0 0 144 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M131.967 19.144C131.373 19.144 130.851 18.64 130.851 18.046C130.851 17.452 131.373 16.966 131.967 16.966C132.579 16.966 133.083 17.452 133.083 18.046C133.083 18.64 132.579 19.144 131.967 19.144Z"
          fill={colors.accent}
        />
        <path
          d="M128.53 19.144C127.936 19.144 127.414 18.64 127.414 18.046C127.414 17.452 127.936 16.966 128.53 16.966C129.142 16.966 129.646 17.452 129.646 18.046C129.646 18.64 129.142 19.144 128.53 19.144Z"
          fill={colors.accent}
        />
        <path
          d="M125.092 19.144C124.498 19.144 123.976 18.64 123.976 18.046C123.976 17.452 124.498 16.966 125.092 16.966C125.704 16.966 126.208 17.452 126.208 18.046C126.208 18.64 125.704 19.144 125.092 19.144Z"
          fill={colors.accent}
        />
        <path
          d="M119.053 22.834C116.803 22.834 115.579 21.88 115.579 20.674C115.579 19.72 116.497 18.946 117.775 18.532C117.091 18.154 116.857 17.74 116.857 17.308C116.857 16.552 117.559 15.958 118.783 15.562C118.081 15.094 117.541 14.284 117.541 13.33C117.541 11.494 119.269 10.108 121.015 10.108C121.465 10.108 121.987 10.234 122.419 10.45H124.795C124.993 10.45 125.083 10.576 124.993 10.774L124.885 10.99C124.831 11.116 124.723 11.188 124.579 11.188H123.049C123.391 11.638 123.697 12.214 123.697 12.952C123.697 14.662 121.987 16.012 120.151 16.012C119.773 16.012 119.395 15.904 119.035 15.706C118.477 15.94 118.045 16.264 118.045 16.678C118.045 17.092 118.459 17.272 119.611 17.614L120.385 17.848C122.275 18.424 123.283 18.82 123.283 19.972C123.283 21.556 121.321 22.834 119.053 22.834ZM116.893 20.35C116.893 21.268 117.811 22.258 119.647 22.258C121.195 22.258 122.059 21.502 122.059 20.602C122.059 19.936 121.465 19.684 119.989 19.27L119.071 19.018C118.657 18.91 118.315 18.784 118.045 18.658C117.235 19.072 116.893 19.612 116.893 20.35ZM119.035 13.582C119.035 14.752 119.431 15.508 120.205 15.508C121.303 15.508 122.203 13.996 122.203 12.502C122.203 11.35 121.825 10.612 121.033 10.612C120.007 10.612 119.035 12.052 119.035 13.582Z"
          fill={colors.accent}
        />
        <path
          d="M114.184 19.162C113.158 19.162 112.978 18.244 113.266 16.984L114.364 12.772C114.688 11.548 114.706 11.08 114.004 11.08C113.032 11.08 110.728 13.006 109.702 17.632L109.45 18.766C109.414 18.91 109.306 19 109.144 19H108.19C108.01 19 107.92 18.892 107.956 18.694L109.378 12.502C109.558 11.728 109.486 11.476 108.802 11.278C108.622 11.224 108.568 11.152 108.568 11.062C108.568 10.972 108.64 10.882 108.784 10.846L111.052 10.198C111.25 10.144 111.376 10.252 111.34 10.432L110.53 13.942H110.62C111.88 11.296 113.536 10.09 114.76 10.09C116.182 10.09 116.272 11.224 115.858 12.826L114.778 16.984C114.598 17.794 114.526 18.244 114.922 18.244C115.264 18.244 115.66 17.83 116.2 17.2C116.326 17.056 116.434 17.038 116.524 17.092C116.65 17.164 116.578 17.362 116.326 17.704C115.462 18.874 114.832 19.162 114.184 19.162Z"
          fill={colors.accent}
        />
        <path
          d="M105.094 19.162C104.068 19.162 103.888 18.244 104.176 16.984L105.22 12.502C105.4 11.746 105.328 11.476 104.644 11.278C104.464 11.224 104.41 11.152 104.41 11.062C104.41 10.972 104.482 10.882 104.626 10.846L106.912 10.198C107.11 10.144 107.236 10.252 107.2 10.432L105.688 16.984C105.508 17.794 105.436 18.244 105.832 18.244C106.174 18.244 106.57 17.83 107.11 17.2C107.236 17.056 107.344 17.038 107.434 17.092C107.56 17.164 107.488 17.362 107.236 17.704C106.372 18.874 105.742 19.162 105.094 19.162ZM105.796 7.696C105.796 7.138 106.282 6.67 106.84 6.67C107.398 6.67 107.884 7.138 107.884 7.696C107.884 8.236 107.38 8.704 106.84 8.704C106.282 8.704 105.796 8.236 105.796 7.696Z"
          fill={colors.accent}
        />
        <path
          d="M95.704 19C95.524 19 95.4159 18.892 95.4699 18.694L97.918 8.128C98.098 7.372 98.008 7.102 97.342 6.904C97.162 6.85 97.108 6.778 97.108 6.688C97.108 6.598 97.1799 6.508 97.3239 6.472L99.628 5.788C99.826 5.734 99.934 5.842 99.898 6.022L97.8099 15.148H97.864C99.214 12.412 100.762 10.126 102.4 10.126C102.868 10.126 103.282 10.288 103.534 10.54C103.642 10.648 103.66 10.756 103.606 10.9C103.372 11.548 103.012 11.782 102.634 11.782C102.148 11.782 101.878 11.458 101.338 11.458C100.888 11.458 100.492 11.71 99.8799 12.556L99.628 12.898L100.744 15.994C101.212 17.344 101.464 18.064 101.914 18.064C102.256 18.064 102.598 17.722 103.048 17.2C103.156 17.074 103.264 17.02 103.372 17.092C103.48 17.164 103.39 17.398 103.12 17.776C102.364 18.82 101.698 19.162 101.212 19.162C100.42 19.162 100.078 18.478 99.3939 16.552L98.656 14.428C98.026 15.544 97.3959 16.966 96.9639 18.766C96.9279 18.928 96.838 19 96.676 19H95.704Z"
          fill={colors.accent}
        />
        <path
          d="M92.8146 19.162C91.7886 19.162 91.6086 18.244 91.8966 16.984L92.9946 12.772C93.3186 11.548 93.3366 11.08 92.6346 11.08C91.6626 11.08 89.3586 13.006 88.3326 17.632L88.0806 18.766C88.0446 18.91 87.9366 19 87.7746 19H86.8206C86.6406 19 86.5506 18.892 86.5866 18.694L88.0086 12.502C88.1886 11.728 88.1166 11.476 87.4326 11.278C87.2526 11.224 87.1986 11.152 87.1986 11.062C87.1986 10.972 87.2706 10.882 87.4146 10.846L89.6826 10.198C89.8806 10.144 90.0066 10.252 89.9706 10.432L89.1606 13.942H89.2506C90.5106 11.296 92.1666 10.09 93.3906 10.09C94.8126 10.09 94.9026 11.224 94.4886 12.826L93.4086 16.984C93.2286 17.794 93.1566 18.244 93.5526 18.244C93.8946 18.244 94.2906 17.83 94.8306 17.2C94.9566 17.056 95.0646 17.038 95.1546 17.092C95.2806 17.164 95.2086 17.362 94.9566 17.704C94.0926 18.874 93.4626 19.162 92.8146 19.162Z"
          fill={colors.accent}
        />
        <path
          d="M83.7244 19.162C82.6984 19.162 82.5184 18.244 82.8064 16.984L83.8504 12.502C84.0304 11.746 83.9584 11.476 83.2744 11.278C83.0944 11.224 83.0404 11.152 83.0404 11.062C83.0404 10.972 83.1124 10.882 83.2564 10.846L85.5424 10.198C85.7404 10.144 85.8664 10.252 85.8304 10.432L84.3184 16.984C84.1384 17.794 84.0664 18.244 84.4624 18.244C84.8044 18.244 85.2004 17.83 85.7404 17.2C85.8664 17.056 85.9744 17.038 86.0644 17.092C86.1904 17.164 86.1184 17.362 85.8664 17.704C85.0024 18.874 84.3724 19.162 83.7244 19.162ZM84.4264 7.696C84.4264 7.138 84.9124 6.67 85.4704 6.67C86.0284 6.67 86.5144 7.138 86.5144 7.696C86.5144 8.236 86.0104 8.704 85.4704 8.704C84.9124 8.704 84.4264 8.236 84.4264 7.696Z"
          fill={colors.accent}
        />
        <path
          d="M79.6261 19.162C78.6001 19.162 78.3841 18.226 78.7081 16.984L79.8061 12.772C80.1301 11.548 80.1481 11.08 79.4461 11.08C78.4741 11.08 76.2061 13.024 75.1261 17.668L74.8741 18.748C74.8381 18.892 74.7301 19 74.5681 19H73.6141C73.4341 19 73.3261 18.892 73.3801 18.694L75.8281 8.128C76.0081 7.354 75.9361 7.102 75.2521 6.904C75.0721 6.85 75.0181 6.778 75.0181 6.688C75.0181 6.598 75.0901 6.508 75.2341 6.472L77.5021 5.806C77.7001 5.752 77.8621 5.824 77.8081 6.04L75.9901 13.942H76.0621C77.3221 11.296 78.9781 10.09 80.2021 10.09C81.6241 10.09 81.7141 11.224 81.3001 12.826L80.2201 16.984C80.0401 17.794 79.9681 18.244 80.3641 18.244C80.7061 18.244 81.1021 17.83 81.6421 17.2C81.7681 17.056 81.8761 17.038 81.9661 17.092C82.0921 17.164 82.0201 17.362 81.7681 17.704C80.9041 18.874 80.2741 19.162 79.6261 19.162Z"
          fill={colors.accent}
        />
        <path
          d="M70.068 19.162C68.952 19.162 68.754 18.244 69.078 16.822L70.428 11.026H69.384C69.204 11.026 69.132 10.936 69.132 10.828C69.132 10.702 69.222 10.612 69.348 10.558C70.482 10.072 71.31 9.46 72.012 8.326C72.102 8.182 72.174 8.11 72.318 8.11H72.336C72.498 8.11 72.588 8.236 72.552 8.416L72.102 10.324H73.722C73.92 10.324 73.992 10.468 73.92 10.648L73.848 10.828C73.794 10.972 73.686 11.026 73.542 11.026H71.94L70.554 16.984C70.374 17.794 70.428 18.136 70.878 18.136C71.31 18.136 71.832 17.758 72.516 17.02C72.642 16.894 72.786 16.84 72.876 16.93C72.984 17.038 72.894 17.236 72.606 17.578C71.562 18.874 70.752 19.162 70.068 19.162Z"
          fill={colors.accent}
        />
        <path
          d="M61.7618 19.216C60.8978 19.216 59.7458 18.802 59.2418 17.83C59.1698 17.704 59.1878 17.578 59.2778 17.47C59.4758 17.218 59.7458 17.056 60.0518 17.056C60.4298 17.056 60.6098 17.254 60.8258 17.596C61.2218 18.226 61.5458 18.676 62.2298 18.676C62.8418 18.676 63.3278 18.154 63.3278 17.452C63.3278 16.732 62.9138 16.228 62.0318 15.184L61.5098 14.59C60.7538 13.708 60.4298 13.222 60.4298 12.484C60.4298 11.278 61.5638 10.108 63.1118 10.108C64.1198 10.108 64.9118 10.576 65.2358 11.062C65.3078 11.188 65.3258 11.296 65.2358 11.422C65.0378 11.746 64.7498 11.89 64.4438 11.89C64.1558 11.89 63.9578 11.764 63.6698 11.404C63.2738 10.9 63.0218 10.666 62.5178 10.666C61.9778 10.666 61.5818 11.116 61.5818 11.692C61.5818 12.268 61.8338 12.592 62.7158 13.618L63.2378 14.23C64.0118 15.112 64.5338 15.778 64.5338 16.588C64.5338 17.794 63.5438 19.216 61.7618 19.216Z"
          fill={colors.accent}
        />
        <path
          d="M56.8338 19.162C55.8078 19.162 55.6278 18.244 55.9158 16.984L56.9598 12.502C57.1398 11.746 57.0678 11.476 56.3838 11.278C56.2038 11.224 56.1498 11.152 56.1498 11.062C56.1498 10.972 56.2218 10.882 56.3658 10.846L58.6518 10.198C58.8498 10.144 58.9758 10.252 58.9398 10.432L57.4278 16.984C57.2478 17.794 57.1758 18.244 57.5718 18.244C57.9138 18.244 58.3098 17.83 58.8498 17.2C58.9758 17.056 59.0838 17.038 59.1738 17.092C59.2998 17.164 59.2278 17.362 58.9758 17.704C58.1118 18.874 57.4818 19.162 56.8338 19.162ZM57.5358 7.696C57.5358 7.138 58.0218 6.67 58.5798 6.67C59.1378 6.67 59.6238 7.138 59.6238 7.696C59.6238 8.236 59.1198 8.704 58.5798 8.704C58.0218 8.704 57.5358 8.236 57.5358 7.696Z"
          fill={colors.accent}
        />
        <path
          d="M44.0236 22.762C43.5016 22.762 43.1056 22.582 42.8536 22.384C42.7276 22.276 42.7096 22.15 42.7816 22.006C43.0336 21.574 43.3396 21.286 43.8436 21.286C44.3656 21.286 44.6536 21.556 45.2296 21.556C45.8956 21.556 46.4716 20.998 47.1736 20.296C47.4076 20.062 47.6416 19.81 47.8756 19.54L46.3096 12.682C46.0936 11.728 45.9676 11.368 45.3196 11.242C45.1396 11.206 45.0676 11.152 45.0676 11.044C45.0676 10.954 45.1576 10.882 45.3016 10.828L46.9576 10.18C47.1196 10.108 47.2816 10.126 47.3176 10.324L49.0096 18.082C50.1976 16.39 51.1696 14.446 51.1696 13.006C51.1696 11.854 50.2876 11.62 50.2876 10.99C50.2876 10.594 50.6296 10.252 51.2056 10.108C51.3316 10.072 51.4396 10.09 51.5476 10.162C52.0876 10.522 52.3036 11.152 52.3036 11.8C52.3036 13.798 49.9276 18.28 47.4616 20.746C46.0756 22.132 45.1756 22.762 44.0236 22.762Z"
          fill={colors.accent}
        />
        <path
          d="M40.0853 19.072C39.9953 19.072 39.9053 19.018 39.8873 18.856L38.8793 12.466C38.7533 11.674 38.6273 11.35 37.9973 11.242C37.8173 11.206 37.7453 11.152 37.7453 11.044C37.7453 10.936 37.8533 10.882 37.9793 10.828L39.6533 10.18C39.8513 10.108 39.9773 10.162 40.0133 10.36L41.0933 17.506C42.2273 16.246 43.7753 14.194 43.7753 12.826C43.7753 11.836 42.9293 11.584 42.9293 10.972C42.9293 10.594 43.2713 10.27 43.8473 10.126C43.9733 10.09 44.0813 10.108 44.1893 10.18C44.7113 10.522 44.9273 11.098 44.9273 11.728C44.9273 14.14 41.5073 17.794 40.4633 18.838C40.2833 19.018 40.1933 19.072 40.1033 19.072H40.0853Z"
          fill={colors.accent}
        />
        <path
          d="M36.176 18.532C36.32 18.568 36.41 18.64 36.41 18.784C36.41 18.928 36.284 19 36.14 19H32.09C31.946 19 31.82 18.928 31.82 18.784C31.82 18.64 31.946 18.55 32.108 18.514C32.828 18.352 33.35 18.19 33.512 17.524L35.744 7.84C35.906 7.174 35.42 7.012 34.808 6.868C34.646 6.832 34.538 6.76 34.538 6.616C34.538 6.472 34.664 6.4 34.808 6.4H38.858C39.002 6.4 39.128 6.472 39.128 6.616C39.128 6.76 39.02 6.832 38.858 6.868C38.246 6.976 37.58 7.138 37.418 7.858L35.204 17.542C35.042 18.226 35.528 18.37 36.176 18.532Z"
          fill={colors.accent}
        />
        <path
          d="M6.06844 10.403C4.30431 7.37882 3.42225 5.86671 3.61425 5.08177C3.79149 4.35721 4.35721 3.79149 5.08177 3.61425C5.86671 3.42225 7.37882 4.30431 10.403 6.06844C10.9751 6.40213 11.2611 6.56897 11.5649 6.63669C11.8514 6.70056 12.1486 6.70056 12.4351 6.63669C12.7389 6.56897 13.0249 6.40213 13.597 6.06844C16.6212 4.30431 18.1333 3.42225 18.9182 3.61425C19.6428 3.79149 20.2085 4.35721 20.3857 5.08177C20.5778 5.86671 19.6957 7.37882 17.9316 10.403C17.5979 10.9751 17.431 11.2611 17.3633 11.5649C17.2994 11.8514 17.2994 12.1486 17.3633 12.4351C17.431 12.7389 17.5979 13.0249 17.9316 13.597C19.6957 16.6212 20.5778 18.1333 20.3857 18.9182C20.2085 19.6428 19.6428 20.2085 18.9182 20.3857C18.1333 20.5778 16.6212 19.6957 13.597 17.9316C13.0249 17.5979 12.7389 17.431 12.4351 17.3633C12.1486 17.2994 11.8514 17.2994 11.5649 17.3633C11.2611 17.431 10.9751 17.5979 10.403 17.9316C7.37882 19.6957 5.86671 20.5778 5.08177 20.3857C4.35721 20.2085 3.79149 19.6428 3.61425 18.9182C3.42225 18.1333 4.30431 16.6212 6.06844 13.597C6.40213 13.0249 6.56897 12.7389 6.63669 12.4351C6.70056 12.1486 6.70056 11.8514 6.63669 11.5649C6.56897 11.2611 6.40213 10.9751 6.06844 10.403Z"
          fill={colors.accent}
        />
      </svg>
    </div>
  );
}

/* ─── Prompt Bar ──────────────────────────────────────────── */

function PromptBar() {
  return (
    <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-[375px] flex flex-col items-start">
      <div
        className="h-[50px] shrink-0 w-full overflow-hidden"
        style={{
          background:
            "linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.95))",
        }}
      />
      <div
        className="w-full flex flex-col items-start overflow-hidden shrink-0"
        style={{ backgroundColor: colors.surface }}
      >
        <div
          className="w-[375px] shrink-0 overflow-hidden rounded-tl-[24px] rounded-tr-[24px] rounded-bl-[45px] rounded-br-[45px] pt-[24px] pb-[36px] px-[22px]"
          style={{ backgroundColor: colors.secondary }}
        >
          <div className="flex items-center justify-between w-full">
            <div className="flex items-center gap-[8px]">
              <ShieldIcon />
              <span
                className="text-[18px] leading-[24.85px] tracking-[-0.89px] font-normal"
                style={{ color: colors.primary, fontFamily: font }}
              >
                Ask Ivy...
              </span>
            </div>

            <div className="flex gap-[4px] h-[48px] items-center">
              <div
                className="w-[52px] h-full rounded-[24px] flex items-center justify-center"
                style={{ border: `1px solid ${colors.borderInput}` }}
              >
                <AttachmentIcon />
              </div>
              <div
                className="w-[52px] h-full rounded-[24px] flex items-center justify-center"
                style={{ border: `1px solid ${colors.borderInput}` }}
              >
                <MicrophoneIcon />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

/* ─── Main Demo ───────────────────────────────────────────── */

export function IvyIsThinkingDemo({ replayCount = 0 }: { replayCount?: number }) {
  const { key, replay } = useReplay();

  return (
    <DemoShell onReplay={replay}>
      <div key={key} className="absolute inset-0 overflow-hidden bg-white">
        <SelectedChip />
        <IvyThinkingIndicator />
        <PromptBar />
        <TopNav rightSlot={<CareTeamBadgeCompact />} />
      </div>
    </DemoShell>
  );
}
